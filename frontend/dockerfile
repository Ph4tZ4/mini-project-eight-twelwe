FROM node:20-alpine

WORKDIR /app

# Build-time environment variable
ARG VITE_API_URL=http://localhost:5550
ENV VITE_API_URL=$VITE_API_URL

# ติดตั้ง dependencies
COPY package*.json ./
RUN npm install

# คัดลอกไฟล์โปรเจกต์
COPY . .

# Set environment for build
ENV NODE_ENV=production
ENV VITE_API_URL=$VITE_API_URL

# Build Nuxt project
RUN npm run build

# ตรวจสอบว่า build output มีอยู่จริง
RUN ls -la .output/server/

EXPOSE 3000

# Start server with proper configuration
CMD ["node", ".output/server/index.mjs"]
